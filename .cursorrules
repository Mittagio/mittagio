# Mittagio - Cursor Rules

## Projekt-√úbersicht

**Mittagio** ist eine digitale Vermittlungs- & Entdeckungsplattform f√ºr strukturierte Mittagstische.

- **Typ:** Single-Page-Application (SPA) in `app/index.html`
- **Deployment:** GitHub Pages (`/mittagio/app/`)
- **Base-Path:** `<base href="/mittagio/app/">`
- **Service Worker:** aktuell deaktiviert (`sw.js.disabled`)

## Wichtigste Projektprinzipien

### Grundprinzip
- **Vermittlungs- & Entdeckungsplattform** mit optionalem Checkout-System
- **Zwei Modi f√ºr Anbieter:**
  - **Mit Abholnummer (hasPickupCode=true):** Online-Zahlung m√∂glich, Stripe Checkout, Abholnummer wird generiert
  - **Ohne Abholnummer (hasPickupCode=false):** Reine Vermittlung, Zahlung vor Ort, direkter Kontakt
- **Keine Mindestlaufzeit, kein Abo f√ºr Endkunden**
- **Vertr√§ge:** Bei Abholnummer-System entsteht Vertrag online, sonst vor Ort

### Klare Trennung der Bereiche

**Endkundenbereich:**
- √ñffentlich, ohne Login, ohne Profil, ohne Registrierung
- Routen: `/`, `/entdecken`, `/favoriten`, `/mittagsbox`, `/checkout`, `/abholnummer`, `/profil`, `/datenschutz`, `/impressum`, `/agb`
- **Mittagsbox (Warenkorb):** Sammlung von Gerichten f√ºr Bestellung
- **Checkout:** Stripe-Zahlung f√ºr Gerichte mit `hasPickupCode=true`
- **Abholnummer:** Wird nach erfolgreicher Zahlung generiert und angezeigt

**Anbieterbereich:**
- Eigener App-Bereich unter `/anbieter/*`
- Eigene Layout-Shell (Header + Anbieter-BottomNav)
- Routen: `/anbieter/dashboard`, `/anbieter/profil`, `/anbieter/profil/bearbeiten`, `/anbieter/recht/*`, `/anbieter/hilfe`
- `/anbieter` ‚Üí Redirect auf `/anbieter/dashboard`

**‚ùå KEINE Vermischung von Endkunden- & Anbieter-Logik**

## Routing-Regeln

### Logo-Regel
- Klick auf Mittagio-Logo im Anbieterbereich ‚Üí **immer `/anbieter/dashboard`**

### Back-Regel
- ‚ùå **KEIN** Browser-Back (`history.back()`)
- ‚úÖ **Immer explizite In-App-Navigation**
- Fallback immer: `/anbieter/dashboard`

### Dead-Click-Regel (SEHR WICHTIG)
- **Jeder klickbare Button MUSS reagieren**
- Erlaubt: Navigation, Toast/Hinweis
- ‚ùå Verboten: Klick ohne Reaktion

## UI-Texte (VERBINDLICH)

**WICHTIG:** Diese Texte M√úSSEN exakt so verwendet werden. Keine eigenen Erfindungen!

### Endkunden-Dashboard ("Mein Mittagio")
- **Titel:** Dein Mittag in der N√§he
- **Willkommenskarte:**
  - √úberschrift: Willkommen bei Mittagio üëã
  - Text: Finde frische Mittagsangebote in deiner N√§he.
  - Button: Angebote entdecken
- **K√ºrzlich angesehen:** Titel + Button "Angebote ansehen"
- **Anbieter-CTA:**
  - Titel: Als Anbieter starten
  - Text: Mittagtische einfach online anbieten
  - Button: Zum Anbieterbereich

### ‚úÖ Erlaubte Begriffe (Endkunden)
- **Mittagsbox** (statt Warenkorb)
- **Abholnummer** (statt Ticket/Abholcode)
- **"In die Mittagsbox"** (Button in Detailansicht)
- **"Abholnummer jetzt sichern"** (Checkout-Button)
- **"Meine Mittagsbox"** (Titel der Cart-View)
- **"Aktive Abholnummern"** (f√ºr bereits bezahlte Bestellungen)

### ‚ùå Verbotene Begriffe (Endkunden)
- Profil anlegen (kein Nutzerkonto)
- "Meine Bestellungen" (nur "Aktive Abholnummern")
- "Bestellen" (statt "In die Mittagsbox")
- "Ticket" oder "Abholcode" (immer "Abholnummer")

### Anbieter-Dashboard
- **Erlaubt:** Inserate, Abholung, Kochbuch, Button "Inserat erstellen"
- **Optional (graue Stepper-Tags):** ‚ûú Inserat erstellen, ‚ûú Gericht w√§hlen, ‚ûú Abholcode (optional)
- **‚ùå Entfernen:** "Willkommen bei Mittagio", "Starte mit deinem ersten Gericht", "Adresse hinzuf√ºgen"

### Rechtstexte
- ‚úÖ Exakt so: AGB, Impressum, Datenschutz
- ‚ùå Nie: AGB-Kurzfassung, Hinweise wie "√∂ffnet dein E-Mail-Programm"

**Vollst√§ndige UI-Texte:** Siehe `CURSOR_UI_TEXTE.md`

## Datenschutz & Endkunden

### Endkunden-Datenschutz
- Gilt f√ºr **Besucher & Endkunden**
- Route: `/datenschutz`
- Keine Registrierung, keine Bestellungen, keine Zahlungen, kein Nutzerkonto
- Kein Marketing-Tracking, keine Werbung
- DSGVO-konform (MVP-Level)

### Erlaubte Endkunden-Daten
- Technisch notwendige Daten
- Standort max. **Stadt / Region**
- Session-basierte Anzeige (z. B. zuletzt angesehen)

### Erlaubt (MVP-Level)
- **Mittagsbox (Warenkorb):** Session-basiert, LocalStorage
- **Checkout:** Stripe Checkout f√ºr Gerichte mit `hasPickupCode=true`
- **Abholnummer:** Wird nach Zahlung generiert, angezeigt in `v-pickup-code`
- **Aktive Abholnummern:** Liste der bezahlten Bestellungen im Profil
- **Favoriten:** LocalStorage-basiert, keine Registrierung n√∂tig

### Nicht erlaubt
- Profil anlegen / Nutzerkonto
- "Meine Bestellungen" (nur "Aktive Abholnummern")
- Personalisierte Nutzerprofile mit Login
- Abholcodes f√ºr Gerichte ohne `hasPickupCode`

## Code-Qualit√§t & Standards

### Technische Regeln
- Alle DOM-Zugriffe mit **Null-Checks** absichern
- **Keine `history.back()`** verwenden
- **Immer explizite Navigation**
- Jeder Button muss reagieren (Dead-Click-Regel)
- **Toast statt Alert**: Immer `showToast('Nachricht')` verwenden, nie `alert()`
- **Arbeitsverzeichnis**: Immer in `C:\Projekte\mittagio` arbeiten (NICHT OneDrive)

### Design-System (Farben & Haptik)
- **Mittagio-Gelb**: `#FFD700` (Sattes, warmes Gelb ‚Äì wie eine frische Kruste)
- **K√ºchen-Anthrazit**: `#121826` (Dunkel, edel, hoher Kontrast)
- **Schatten f√ºr gelbe Buttons**: `box-shadow: 0 25px 50px -12px rgba(255, 215, 0, 0.25)` (Schwebe-Effekt)
- **CSS-Variablen**: `var(--brand)` = `#FFD700`, `var(--border)` f√ºr Rahmen
- **Micro-Interactions**: Buttons mit `transform: scale(0.98)` bei `:active` (0.1s)

### Design-Standards
- **Premium Card-Design**: Horizontales Layout (`.dish-card`, 140px H√∂he)
- **Lucide Icons**: Immer `<i data-lucide="icon-name"></i>` verwenden
- **Nach Rendering**: `lucide.createIcons()` aufrufen (mit `setTimeout` f√ºr dynamische Inhalte)
- **Buttons**: Mindesth√∂he 44px (Fat-Finger-Safe), runde Icon-Buttons 34px, FAB 56px
- **CTA-Buttons**: `h-16` (64px), `rounded-3xl`, `bg-[#FFD700]`, `text-black`, `font-weight: 900`
- **Paddings**: Konsistentes 16px-Raster f√ºr alle Container
- **Safe Areas**: `env(safe-area-inset-top/bottom)` f√ºr Header und Bottom Nav
- **Filter-Chips**: Horizontal scrollbar, letztes Element leicht abgeschnitten als Scroll-Hinweis

### Implementierte Features

**Entdeckung & Navigation:**
- **Tinder-Swipe**: View-Toggle Liste/Swipe, Touch-Gesten, Haptic Feedback, Match Modal
- **Floating Action Button (FAB)**: Modus-Wechsel (Liste ‚Üî Inspiration), Glassmorphism, Puls-Animation
- **Mittagspausen-Timer**: Gehzeit-Berechnung (5 km/h), "Noch X Min zu Fu√ü" Badge
- **Social-Proof**: "Heute schon Xx bestellt" Badge (gelb, users-Icon)
- **Invite-Feature**: "Ich hole mir heute [Gericht] bei [Metzger] ‚Äì kommst du mit?"
- **Skeleton-Screens**: Loading-Placeholder mit pulse-Animation
- **Sticky Header**: Zwei Ebenen (Quick-Filters + Kategorien), Safe Areas f√ºr Samsung S25

**Bestellung & Zahlung:**
- **Mittagsbox (Warenkorb)**: Session-basiert, LocalStorage, "Meine Mittagsbox" als Titel
- **Checkout-Flow**: Stripe Checkout f√ºr Gerichte mit `hasPickupCode=true`
- **Abholnummer-System**: Wird nach Zahlung generiert, Format "A1", "B5", etc.
- **Flexibler Time-Picker**: 15-Minuten-Slots (11:30-14:00), Auto-Auswahl n√§chster Slot, "Andere Zeit" Option
- **Trust-Icons**: "Sichere Zahlung", "Ein Anbieter", "Abholnummer sofort"

**Anbieter-Features:**
- **Foto-KI**: Mock GPT-4o Vision API, Auto-Tagging von Allergenen (ohne Mengensch√§tzungen)
- **Ein-Hand-Check-in (USP)**: Gro√üe Abholnummern-Kacheln (72px), Tap-to-Complete, Gr√ºner Flash, Sortierung nach Abholzeit
- **No-Limits Inseratsflow**: Keine Mengenangaben, prominenter "Ausverkauft"/"Noch da" Toggle, active=false Gerichte verschwinden aus Feed
- **Monetarisierung**: Inseratsgeb√ºhr (4,99 ‚Ç¨) + All-In Erfolgsgeb√ºhr (0,89 ‚Ç¨ pro Verkauf)

**Design-System:**
- **Konsistente Paddings**: 16px-Raster f√ºr alle Container
- **Safe Areas**: `env(safe-area-inset-top/bottom)` f√ºr moderne Ger√§te
- **Weichere Schatten**: `box-shadow: 0 4px 16px rgba(0,0,0,.08)`
- **Swipe-Cards**: Rand `calc(100% - 32px)`, zentriert, `border-radius: 24px`

### Projektstruktur
```
mittagio/
‚îú‚îÄ‚îÄ app/                    # Hauptcode (SPA)
‚îÇ   ‚îú‚îÄ‚îÄ index.html         # Single-Page-Application
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json      # PWA Manifest
‚îÇ   ‚îú‚îÄ‚îÄ assets/            # Bilder, Icons
‚îÇ   ‚îî‚îÄ‚îÄ sw.js.disabled     # Service Worker (deaktiviert)
‚îú‚îÄ‚îÄ docs/                  # Produkt- & UX-Konzept
‚îú‚îÄ‚îÄ tickets/               # Feature-Tickets
‚îî‚îÄ‚îÄ .cursorrules           # Diese Datei
```

### Wichtige Dateien f√ºr Kontext
- `CURSOR_CONTEXT_MITTAGIO.md` - Vollst√§ndige Projektzusammenfassung
- `CURSOR_UI_TEXTE.md` - Verbindliche UI-Texte
- `CURSOR_CONTEXT_MITTAGIO_KURZ.md` - Kurzfassung
- `PROMPTS.md` - Wiederverwendbare Master-Prompts (Prompt-Library)

## Golden Rules (f√ºr Cursor)

> Wenn sich etwas **wie ein Shop oder Account** anf√ºhlt ‚Üí **falsch** (au√üer Checkout-Flow)
> Wenn ein Klick **nichts tut** ‚Üí **nicht done**
> Wenn Endkunde & Anbieter vermischt sind ‚Üí **Bug**
> Wenn "Ticket" oder "Abholcode" verwendet wird ‚Üí **immer "Abholnummer" verwenden**
> Wenn "Warenkorb" verwendet wird ‚Üí **immer "Mittagsbox" verwenden**

## Empfohlener Cursor-Prompt

**Immer davor schreiben:**
> "Bitte strikt nach der Cursor-Gesamtzusammenfassung Mittagio (Stand 24.01.2026) arbeiten und ausschlie√ülich die verbindlichen UI-Texte verwenden."

## Git & Synchronisation

- Alle √Ñnderungen m√ºssen committed und gepusht werden
- Schnell-Sync: `sync-to-github.bat` (Windows) oder `sync-to-github.sh` (Mac/Linux)
- Siehe `SYNC_CHECKLIST.md` f√ºr Details

## Wichtige Implementierungsdetails

### Checkout-Flow
- **Route**: `#checkout` ‚Üí `v-checkout` View
- **Voraussetzung**: Alle Gerichte im Cart m√ºssen `hasPickupCode=true` haben
- **Zahlung**: Stripe Checkout (Gastzahlung, E-Mail optional)
- **Nach Zahlung**: Abholnummer wird generiert, Order-Status ‚Üí `PAID`
- **Abholnummer-Anzeige**: `v-pickup-code` View mit gro√üem Code-Display

### Abholnummer-System
- **Format**: Buchstabe + Zahl (z.B. "A1", "B5", "C2")
- **Generierung**: `generatePickupCode()` ‚Üí zuf√§llige Kombination
- **Zuweisung**: `assignPickupCode(orderId)` ‚Üí speichert in Order
- **Anbieter-Dashboard**: Gro√üe Kacheln (72px), Tap-to-Complete, gr√ºner Flash

### Mittagsbox (Cart)
- **LocalStorage**: `LS.cart` mit `{items: [], pickupTime: '', customerName: '', customerEmail: ''}`
- **Badge**: Zeigt Anzahl der Items in Bottom Nav
- **Clear Cart**: M√ºlleimer-Icon mit Bottom-Sheet Best√§tigung
- **Trust-Icons**: "Sichere Zahlung", "Ein Anbieter", "Abholnummer sofort"

### FAB (Floating Action Button)
- **Position**: `bottom: calc(80px + env(safe-area-inset-bottom) + 20px)`, `right: 16px`
- **Icon-Wechsel**: `sparkles` (Inspiration) ‚Üî `list` (Liste)
- **Animation**: Puls-Effekt beim Klick (`fabPulse` Keyframes)
- **Micro-Hint**: "Lust auf Inspiration?" beim ersten Start (2 Sekunden)

---

**Stand:** 26.01.2026  
**Letzte Aktualisierung:** 26.01.2026 (Checkout-Flow, Abholnummer-System, FAB, Design-System)
