---
description: Architektur-Klarstellung â€“ openDishFlow (Initiator) vs. InseratCard (UI). Verhindert Logik-Fehler und falsche UI-Zuordnung.
alwaysApply: true
---

# ARCHITEKTUR: DISH-FLOW VS. INSERAT-CARD

**Trennung strikt einhalten.** Cursor darf keine UI-Logik in den Initiator schreiben und keine Flow-Start-Logik in die InseratCard.

## 1. Der Initiator (openDishFlow)

- **Keine UI-Komponente**, reine Logik-Funktion. [cite: 2026-02-16]
- **Aufgabe:** Auswahl-Sheet schlieÃŸen (`closeCreateFlowSheet`) und Prozess starten via `startListingFlow(ctx)`.
- **Parameter:** `date` (Ziel-Datum), `ep` (EntryPoint: z.â€¯B. `'dashboard'` oder `'week'`).
- **Referenz im Code:** `app/index.html` â€“ `openDishFlow(defaultDate, entryPoint)` ruft nur `startListingFlow(ctx)` auf.

**Verboten:** UI-Elemente, DOM-Zugriffe, Styles oder Rendering-Logik in `openDishFlow` einbauen.

## 2. Die Komponente (InseratCard)

- **Die visuelle Maske** (Wizard-Inhalt). [cite: 2026-02-16]
- Wird **innerhalb** von `startWizard('listing', ctx)` durch **`buildListingStep()`** gerendert.
- **EnthÃ¤lt:** Foto-Modul, Power-Bar (ğŸ´, ğŸ”„, ğŸ•’, ğŸŒ¾, â•), editierbarer Titel, Preis, Action-Buttons am Ende (â€mit Abholnummerâ€œ / â€Nur Inseratâ€œ). [cite: 2026-01-29, 2026-02-16]
- **Referenz im Code:** `app/index.html` â€“ `buildListingStep()` baut den gesamten Inhalt des `#wizard` fÃ¼r den Listing-Flow.

**Alle gestalterischen und inhaltlichen Ã„nderungen an der Inserat-Karte** gehÃ¶ren in `buildListingStep()` bzw. die davon aufgebauten DOM-Strukturen/CSS, **nicht** in `openDishFlow`.

## 3. Logik â€Neues Gerichtâ€œ

- Wird `startListingFlow` **ohne** `dishId` aufgerufen â†’ InseratCard mit **leerem Entwurf** Ã¶ffnen (oder LeberkÃ¤se-Onboarding-Template beim ersten Mal). [cite: 2026-01-29, 2026-02-16]
- **Vor dem Rendern:** Draft-Check durchfÃ¼hren â€“ â€Letzten Entwurf fortsetzen?â€œ (Restore/Verwerfen). [cite: 2026-02-16]
- Der Entwurfs-Check sitzt **vor** dem Rendern der Karte (in `startListingFlow`), nicht in der InseratCard selbst.

## 4. Monetarisierung in der InseratCard

Die InseratCard muss am Ende **immer** zwei Optionen anbieten:

- **Option A:** Gratis inserieren mit Abholnummer (0,89 â‚¬ pro Vorgang fÃ¼r den Kunden). [cite: 2026-01-29]
- **Option B:** â€Nur Inseratâ€œ fÃ¼r 4,99 â‚¬ Fixpreis. [cite: 2026-01-29]

## Warum die Trennung wichtig ist

| Aspekt | Initiator (openDishFlow) | Komponente (InseratCard / buildListingStep) |
|--------|--------------------------|---------------------------------------------|
| **Wiederverwendbarkeit** | Kann von Ã¼berall aufgerufen werden (Dashboard, Wochenplan, Button). | Nur fÃ¼r Anzeige und Eingabe zustÃ¤ndig. |
| **Fehlervermeidung** | Keine UI-Elemente hier. | Gestaltung und Interaktion nur hier. |
| **State-Management** | Ãœbergibt nur Kontext (date, entryPoint). | Entwurfs-Check liegt vor dem Rendern in `startListingFlow`. |

## Kurzreferenz

- **Ã–ffnen/Starten:** `openDishFlow(date, ep)` â†’ `startListingFlow(ctx)` â†’ ggf. Draft-Check â†’ `startWizard('listing', ctx)` â†’ **`buildListingStep()`** rendert die InseratCard.
- **Ã„nderungen am Flow-Start:** nur in `openDishFlow` / `startListingFlow` / Draft-Check.
- **Ã„nderungen an der Karte:** nur in `buildListingStep()` und zugehÃ¶rigem CSS/DOM.
