---
description: Core Logic â€“ Hub, Entry Points und Component Rules fÃ¼r den Unified Inserat-Flow. Nur eine Komponente: InseratCard im #wizard. [cite: 2026-02-18]
alwaysApply: true
---

# CORE LOGIC ARCHITECTURE: THE UNIFIED INSERAT-FLOW

Jede Inserat-Aktion endet in **einer** â€Sammelkartenâ€œ-OberflÃ¤che: der **InseratCard** im **#wizard**. Diese Regel beschreibt das Hub-Konzept, die Einstiege und die Component Rules.

## 1. The Hub (nur InseratCard)

Es gibt **nur eine** Darstellung der Inserat-Karte:

- **Wizard-InseratCard:** Wird von `buildListingStep()` im `#wizard` gerendert. FÃ¼r **alle** ZustÃ¤nde: neues Gericht, Bearbeiten (Edit), aus Kochbuch, aus Wochenplan, Renner, Blitz.

**Legacy (nicht verwenden):** Das Provider-Sheet (**#psheet**) und die Funktion **openProviderOffer()** existieren noch im Code, sind aber **veraltet**. Neue Logik und neue UI dÃ¼rfen **nicht** auf psheet oder `openProviderOffer` bauen. Alle Einstiege fÃ¼hren Ã¼ber `startListingFlow()` in die InseratCard im #wizard. Siehe **inserat-flow-stop-order.mdc**.

Die zwei Modi werden **innerhalb** der einen InseratCard Ã¼ber Kontext gesteuert:

| Zustand | Steuerung | Bedeutung |
|--------|-----------|-----------|
| **MODE_AD** | `entryPoint === 'dashboard'` (oder Edit) | Buttons â€mit Abholnummerâ€œ (0,89 â‚¬) und â€Nur Inseratâ€œ (4,99 â‚¬) aktiv. |
| **MODE_PLAN** | `entryPoint === 'cookbook'` oder `'week'` | Buttons â€Im Kochbuch speichernâ€œ / â€Im Wochenplan speichernâ€œ, Gelb â€Abbrechenâ€œ. |

**Referenz im Code:** `app/index.html` â€“ `buildListingStep()` (Action-Buttons, `isInserierenRoute`, `actionSection`).

## 2. Entry Points

Alle Einstiege landen in der **InseratCard im #wizard** (via `startListingFlow` â†’ `buildListingStep()`):

| Einstieg | Verhalten | Wo landet der Nutzer | Modus |
|----------|-----------|----------------------|-------|
| **New Dish** | â€Neues Gericht erstellenâ€œ â†’ `openDishFlow` â†’ `startListingFlow(ctx)`. Leer oder Draft-Overlay (â€Fortsetzen?â€œ). | InseratCard im #wizard | MODE_AD |
| **Renner (Bestseller)** | `startListingFlow({ dishId, date, entryPoint: 'dashboard', skipQuickPost: true })`. InseratCard mit Kochbuch-Daten. | InseratCard im #wizard | MODE_AD |
| **Edit (bestehendes Inserat)** | `startListingFlow({ editOfferId: id })`. InseratCard mit Offer-Daten. | InseratCard im #wizard | MODE_AD |
| **Kochbuch / Wochenplan** | `startListingFlow({ dishId, entryPoint: 'week'|'cookbook', date })`. | InseratCard im #wizard | MODE_PLAN |

Blitz und alle anderen Aktionen, die frÃ¼her psheet geÃ¶ffnet haben, sollen ebenfalls Ã¼ber `startListingFlow` (ggf. mit `editOfferId` oder Kochbuch-Kontext) in die **gleiche** InseratCard mÃ¼nden â€“ nicht in #psheet.

## 3. Component Rules

- **Power-Bar:** (ğŸ´, ğŸ”„, ğŸ•’, ğŸŒ¾, â•, â“˜) in der InseratCard **immer sichtbar**. Siehe Blueprint in **inserat-flow-stop-order.mdc**.
- **Preis-Button (Gelb):** Rechts in der Action-Row; Hero-Morph zum 4rem-Eingabefeld. Referenz: `buildListingStep()` in `app/index.html`.
- **Universal-X:** SchlieÃŸt den Flow mit der Pop-Away-Animation (Klasse `x-pop-away`).

## Abgrenzung

- **inserat-flow-stop-order.mdc:** STOP-ORDER, einzige gÃ¼ltige Kette, Kill-Commands, Architektur-Blueprint.
- **dish-flow-vs-inserat-card.mdc:** Trennung openDishFlow (Initiator) vs. InseratCard (buildListingStep).
