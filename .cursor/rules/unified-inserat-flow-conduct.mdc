---
description: Core Logic â€“ Hub, Entry Points und Component Rules fÃ¼r den Unified Inserat-Flow. Verhindert Logik-Fehler bei Navigation und Modi.
alwaysApply: true
---

# CORE LOGIC ARCHITECTURE: THE UNIFIED INSERAT-FLOW

Jede Inserat-Aktion endet in einer â€Sammelkartenâ€œ-OberflÃ¤che. Diese Regel beschreibt das Hub-Konzept, die Einstiege und die einheitlichen Komponenten-Regeln.

## 1. The Hub (InseratCard)

Die InseratCard ist das visuelle Sammelkarten-Interface. Es gibt **zwei Darstellungen**:

- **Wizard-InseratCard:** Wird von `buildListingStep()` im `#wizard` gerendert. FÃ¼r neue EntwÃ¼rfe oder aus dem Kochbuch geladene Gerichte.
- **Provider-Sheet (psheet):** Bearbeitung eines bestehenden oder per Blitz erzeugten Draft-Offers. Wird von `openProviderOffer()` geÃ¶ffnet.

Beide unterscheiden nur **zwei ZustÃ¤nde** (Ã¼ber Kontext, nicht als einzelnes mode-Prop):

| Zustand | Wizard | psheet | Bedeutung |
|--------|--------|--------|-----------|
| **MODE_AD** | `entryPoint === 'dashboard'` | `psheetCardMode === 'ad'` | Buttons â€mit Abholnummerâ€œ (0,89 â‚¬) und â€Nur Inseratâ€œ (4,99 â‚¬) aktiv. |
| **MODE_PLAN** | `entryPoint === 'cookbook'` oder `'week'` | `psheetCardMode === 'plan'` | Buttons â€Speichernâ€œ, â€Im Kochbuch speichernâ€œ bzw. â€Im Wochenplan speichernâ€œ aktiv. |

**Referenz im Code:** `app/index.html` â€“ `buildListingStep()` (Action-Buttons um Zeile 25243â€“25293, `isInserierenRoute`, `actionSection`), `openProviderOffer()` (Zeile 15366, `psheetCardMode`).

## 2. Entry Points

| Einstieg | Verhalten | Wo landet der Nutzer | Modus |
|----------|-----------|----------------------|-------|
| **New Dish** | Start immer leer. Existiert ein Entwurf â†’ Draft-Overlay (â€Fortsetzen?â€œ) auf der Karte (Ghost-Card). Kein `dishId`. | Wizard-InseratCard | MODE_AD (nach Fortsetzen) bzw. leerer Entwurf |
| **Renner (Bestseller)** | Quick-Post-UI wird Ã¼bersprungen (`skipQuickPost: true`). InseratCard wird direkt mit Kochbuch-Daten geladen. | Wizard-InseratCard | MODE_AD |
| **Blitz (âš¡)** | Im Hintergrund wird aus einem Kochbuch-Eintrag ein Offer mit `status: 'draft'` erzeugt (`createOfferFromCookbook`), dann sofort geÃ¶ffnet. | Provider-Sheet (psheet) | MODE_AD |

**Technisch:**

- **New Dish:** `startListingFlow(ctx)` ohne `dishId` â†’ ggf. Ghost-Card-Overlay in `startListingFlow` / `buildListingStep`.
- **Renner:** `startListingFlow({ dishId, date, entryPoint: 'dashboard', skipQuickPost: true })`. Referenz: `populateCreateFlowRenner` in `app/index.html`.
- **Blitz:** `createOfferFromCookbook(cookbookId)` â†’ `openProviderOffer(id, { source: 'cookbook'|'week', instantLive: true })`. Vorkommen: Kochbuch (`.cookbook-blitz-btn`), Wochenplan (`.kw-slot-blitz`). Referenz: `app/index.html` â€“ `createOfferFromCookbook` (Zeile 15337), `openProviderOffer` (Zeile 15366), Blitz-Handler (z. B. Zeile 23830, 20881).

## 3. Component Rules

- **Power-Bar:** (ğŸ´, ğŸ”„, ğŸ•’, ğŸŒ¾, â•, â“˜) ist in Wizard und psheet **immer sichtbar**.
- **Preis-Button (Gelb):** Rechts unten; lÃ¶st den Hero-Morph zum 4rem-Eingabefeld aus. Referenz: bestehende Inserat-/Preis-UI in `app/index.html`.
- **Universal-X:** SchlieÃŸt den Flow **immer** mit der Pop-Away-Animation (Wizard: Klasse `x-pop-away`; psheet: z. B. `exit-active`).

## Abgrenzung

- Die Regel **dish-flow-vs-inserat-card.mdc** regelt die Trennung **openDishFlow (Initiator) vs. InseratCard (Wizard)** und wo UI vs. Logik hingehÃ¶rt.
- Diese Regel beschreibt das **Gesamtbild** (Hub, Modi, Entry Points, Component Rules) und verweist auf dieselben Code-Stellen.
