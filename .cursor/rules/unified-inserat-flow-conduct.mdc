---
description: Core Logic â€“ Hub, Entry Points und Component Rules fÃ¼r den Unified Inserat-Flow. Nur eine Komponente: InseratCard im #wizard. [cite: 2026-02-18]
alwaysApply: true
---

# CORE LOGIC ARCHITECTURE: THE UNIFIED INSERAT-FLOW

Jede Inserat-Aktion endet in **einer** â€Sammelkartenâ€œ-OberflÃ¤che: der **InseratCard** im **#wizard**. Diese Regel beschreibt das Hub-Konzept, die Einstiege und die Component Rules.

## 1. The Hub (nur InseratCard)

Es gibt **nur eine** Darstellung der Inserat-Karte:

- **Wizard-InseratCard:** Wird von `buildListingStep()` im `#wizard` gerendert. FÃ¼r **alle** ZustÃ¤nde: neues Gericht, Bearbeiten (Edit), aus Kochbuch, aus Wochenplan, Renner, Blitz.

**Legacy (nicht verwenden):** Das Provider-Sheet (**#psheet**) und die Funktion **openProviderOffer()** existieren noch im Code, sind aber **veraltet**. Neue Logik und neue UI dÃ¼rfen **nicht** auf psheet oder `openProviderOffer` bauen. Alle Einstiege fÃ¼hren Ã¼ber `startListingFlow()` in die InseratCard im #wizard. Siehe **inserat-flow-stop-order.mdc**.

Der **3-Schritt Mastercard-Flow** gilt fÃ¼r alle entryPoints. Footer in Schritt 1: Links â€Speichernâ€œ (Shortcut bei editOfferId/week/cookbook), Rechts â€Weiterâ€œ (Primary). Keine separaten Modi mehr.

**Referenz im Code:** `app/script.js` â€“ `buildListingStep()`, `startListingFlow()`, `showSpeichernShortcut`.

## 2. Entry Points

Alle Einstiege landen in der **InseratCard im #wizard** (via `startListingFlow` â†’ `buildListingStep()`):

| Einstieg | Verhalten | Wo landet der Nutzer |
|----------|-----------|----------------------|
| **New Dish** | â€Neues Gericht erstellenâ€œ â†’ `openDishFlow` â†’ `startListingFlow(ctx)`. | InseratCard Step 1 im #wizard |
| **Renner (Bestseller)** | `startListingFlow({ dishId, date, entryPoint: 'dashboard', skipQuickPost: true })`. | InseratCard Step 1 im #wizard |
| **Edit (bestehendes Inserat)** | `startListingFlow({ editOfferId: id })`. | InseratCard Step 1 im #wizard |
| **Kochbuch / Wochenplan** | `startListingFlow({ dishId, entryPoint: 'week'|'cookbook', date })`. | InseratCard Step 1 im #wizard |

Blitz und alle anderen Aktionen, die frÃ¼her psheet geÃ¶ffnet haben, sollen ebenfalls Ã¼ber `startListingFlow` (ggf. mit `editOfferId` oder Kochbuch-Kontext) in die **gleiche** InseratCard mÃ¼nden â€“ nicht in #psheet.

## 3. Component Rules

- **Power-Bar:** (ğŸ´, ğŸ”„, ğŸ•’, ğŸŒ¾, â•, â“˜) in der InseratCard **immer sichtbar**. Siehe Blueprint in **inserat-flow-stop-order.mdc**.
- **Preis-Button (Gelb):** Rechts in der Action-Row; Hero-Morph zum 4rem-Eingabefeld. Referenz: `buildListingStep()` in `app/index.html`.
- **Universal-X:** SchlieÃŸt den Flow mit der Pop-Away-Animation (Klasse `x-pop-away`).

## Abgrenzung

- **inserat-flow-stop-order.mdc:** STOP-ORDER, einzige gÃ¼ltige Kette, Kill-Commands, Architektur-Blueprint.
- **dish-flow-vs-inserat-card.mdc:** Trennung openDishFlow (Initiator) vs. InseratCard (buildListingStep).
